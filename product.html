<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Product | Blackwear</title>
<style>
  *{box-sizing:border-box;font-family:Segoe UI,Arial;}
  body{margin:0;background:#0f0f0f;color:#fff;}
  header{background:#000;padding:14px;text-align:center;font-size:20px;font-weight:bold;color:#ff7f00;}
  .container{padding:16px;max-width:1100px;margin:auto;}
  .main-image{width:100%;max-height:420px;object-fit:cover;border-radius:18px;border:1px solid #222;cursor:pointer;}
  .product-title{font-size:22px;margin:14px 0 6px;}
  .price{color:#ff7f00;font-size:20px;font-weight:bold;}
  .desc{color:#ccc;font-size:14px;line-height:1.6;margin:10px 0;}
  .quantity{display:flex;align-items:center;gap:10px;margin:10px 0;}
  .quantity button{padding:6px 12px;border:none;border-radius:8px;background:#222;color:#fff;cursor:pointer;font-weight:bold;}
  .actions{display:flex;gap:10px;margin-top:14px;}
  .actions button{flex:1;padding:12px;border-radius:14px;border:none;font-weight:bold;cursor:pointer;}
  .cart-btn{background:#222;color:#fff;}
  .buy-btn{background:#ff7f00;color:#000;}
  .wishlist{margin-top:10px;font-size:14px;cursor:pointer;color:#ff7f00;}
  .related{margin-top:30px;}
  .related h3{margin-bottom:10px;}
  .related-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;}
  .related-grid img{width:100%;height:120px;object-fit:cover;border-radius:12px;border:1px solid #222;cursor:pointer;transition:.2s;}
  .related-grid img:hover{border-color:#ff7f00;}
  footer{text-align:center;color:#666;padding:20px;font-size:13px;}
</style>
</head>
<body>

<header>Blackwear</header>

<div class="container">
  <img id="mainImage" class="main-image" src="" alt="Product">
  <h2 id="title" class="product-title"></h2>
  <div id="price" class="price"></div>
  <p id="desc" class="desc"></p>

  <div class="quantity">
    <button id="decreaseQty">-</button>
    <span id="quantityValue">1</span>
    <button id="increaseQty">+</button>
  </div>

  <div class="actions">
    <button class="cart-btn" id="addCartBtn">Add to Cart</button>
    <button class="buy-btn" id="buyNowBtn">Buy Now</button>
  </div>

  <div class="wishlist" id="wishlistBtn">❤️ Add to Wishlist</div>

  <div class="related">
    <h3>Related Products</h3>
    <div class="related-grid" id="relatedGrid"></div>
  </div>
</div>

<footer>© 2025 Blackwear</footer>

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script>
  // Firebase setup
  firebase.initializeApp({
    apiKey: "AIzaSyBy0bIMp1ORV0UfLgKlxyr2V-I9mJjFb6o",
    authDomain: "blackwear-14a31.firebaseapp.com",
    projectId: "blackwear-14a31"
  });

  const db = firebase.firestore();
  const auth = firebase.auth();
  const el = id => document.getElementById(id);

  let currentProduct = null;
  let quantity = 1;

  const params = new URLSearchParams(window.location.search);
  const productId = params.get("id");

  auth.signInAnonymously().then(loadProduct);

  function escapeHtml(s){ return String(s||''); }

  async function loadProduct(){
    const snap = await db.collection("products").doc(productId).get();
    if(!snap.exists){ alert("Product not found"); return; }

    const p = snap.data();
    currentProduct = {id: snap.id, ...p};

    el("mainImage").src = p.image || (Array.isArray(p.images) && p.images.length ? p.images[0] : "");
    el("title").innerText = escapeHtml(p.name);
    el("price").innerText = "₦" + Number(p.price||0).toLocaleString();
    el("desc").innerText = escapeHtml(p.description || "No description available");

    // Quantity
    el("quantityValue").innerText = quantity;
    el("increaseQty").onclick = () => { quantity++; el("quantityValue").innerText = quantity; }
    el("decreaseQty").onclick = () => { if(quantity>1) quantity--; el("quantityValue").innerText = quantity; }

    // Related products by same category
    loadRelatedProducts(p.category);
  }

  async function loadRelatedProducts(category){
    const relatedGrid = el("relatedGrid");
    relatedGrid.innerHTML = "";

    const snap = await db.collection("products")
      .where("category","==",category)
      .limit(3)
      .get();

    snap.forEach(doc => {
      if(doc.id === productId) return;
      const p = doc.data();
      const imgEl = document.createElement("img");
      imgEl.src = p.image || (p.images ? p.images[0] : "");
      imgEl.onclick = () => window.location.href = "product.html?id=" + doc.id;
      relatedGrid.appendChild(imgEl);
    });
  }

  // Add to cart
  el("addCartBtn").onclick = async () => {
    if(!currentProduct) return;
    await db.collection("cart").add({
      userId: auth.currentUser.uid,
      productId: currentProduct.id,
      productName: currentProduct.name,
      price: currentProduct.price,
      quantity: quantity,
      image: currentProduct.image || "",
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });
    alert(`Added ${quantity} "${currentProduct.name}" to cart ✅`);
  };

  // Buy now
  el("buyNowBtn").onclick = () => {
    if(!currentProduct) return;
    window.location.href = "checkout.html?id=" + currentProduct.id + "&qty=" + quantity;
  };

  // Wishlist
  el("wishlistBtn").onclick = async () => {
    if(!currentProduct) return;
    await db.collection("wishlist").add({
      userId: auth.currentUser.uid,
      productId: currentProduct.id,
      name: currentProduct.name,
      price: currentProduct.price,
      image: currentProduct.image || "",
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });
    alert("Added to wishlist ❤️");
  };
</script>

</body>
</html>
