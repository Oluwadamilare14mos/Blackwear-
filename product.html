<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Product | Blackwear</title>
<style>
  *{box-sizing:border-box;font-family:Segoe UI,Arial;}
  body{margin:0;background:#0f0f0f;color:#fff;}
  header{background:#000;padding:14px;text-align:center;font-size:20px;font-weight:bold;color:#ff7f00;}
  .container{padding:16px;max-width:1100px;margin:auto;}
  .main-image{width:100%;max-height:420px;object-fit:cover;border-radius:18px;border:1px solid #222;cursor:pointer;}
  .product-title{font-size:22px;margin:14px 0 6px;}
  .price{color:#ff7f00;font-size:20px;font-weight:bold;}
  .desc{color:#ccc;font-size:14px;line-height:1.6;margin:10px 0;}
  .actions{display:flex;gap:10px;margin-top:14px;}
  .actions button{flex:1;padding:12px;border-radius:14px;border:none;font-weight:bold;cursor:pointer;}
  .cart-btn{background:#222;color:#fff;}
  .buy-btn{background:#ff7f00;color:#000;}
  .wishlist{margin-top:10px;font-size:14px;cursor:pointer;color:#ff7f00;}
  .related{margin-top:30px;}
  .related h3{margin-bottom:10px;}
  .related-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;}
  .related-grid img{width:100%;height:120px;object-fit:cover;border-radius:12px;border:1px solid #222;cursor:pointer;transition:.2s;}
  .related-grid img:hover{border-color:#ff7f00;}
  footer{text-align:center;color:#666;padding:20px;font-size:13px;}
</style>
</head>
<body>

<header>Blackwear</header>

<div class="container">
  <img id="mainImage" class="main-image" src="" alt="Product">
  <h2 id="title" class="product-title"></h2>
  <div id="price" class="price"></div>
  <p id="desc" class="desc"></p>

  <div class="actions">
    <button class="cart-btn" onclick="addToCart()">Add to Cart</button>
    <button class="buy-btn" onclick="buyNow()">Buy Now</button>
  </div>

  <div class="wishlist" onclick="addWishlist()">❤️ Add to Wishlist</div>

  <div class="related">
    <h3>Related Images</h3>
    <div class="related-grid" id="relatedGrid"></div>
  </div>
</div>

<footer>© 2025 Blackwear</footer>

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script>
  firebase.initializeApp({
    apiKey: "AIzaSyBy0bIMp1ORV0UfLgKlxyr2V-I9mJjFb6o",
    authDomain: "blackwear-14a31.firebaseapp.com",
    projectId: "blackwear-14a31"
  });
  const db = firebase.firestore();
  const auth = firebase.auth();

  let currentProduct = null;
  const params = new URLSearchParams(window.location.search);
  const productId = params.get("id");

  auth.signInAnonymously().then(loadProduct);

  function escapeHtml(s){ return String(s||''); }

  async function loadProduct(){
    const snap = await db.collection("products").doc(productId).get();
    if(!snap.exists){ alert("Product not found"); return; }

    const p = snap.data();
    currentProduct = {id: snap.id, ...p};

    const mainImg = p.image || (Array.isArray(p.images) && p.images.length ? p.images[0] : "");
    document.getElementById("mainImage").src = mainImg;
    document.getElementById("title").innerText = escapeHtml(p.name);
    document.getElementById("price").innerText = "₦" + Number(p.price||0).toLocaleString();
    document.getElementById("desc").innerText = escapeHtml(p.description || "No description available");

    const relatedGrid = document.getElementById("relatedGrid");
    relatedGrid.innerHTML = "";

    if(p.images && p.images.length){
      p.images.slice(0,3).forEach(imgUrl => {
        const imgEl = document.createElement("img");
        imgEl.src = imgUrl;
        imgEl.onclick = () => {
          window.location.href = "product.html?id=" + productId + "&img=" + encodeURIComponent(imgUrl);
        };
        relatedGrid.appendChild(imgEl);
      });
    }

    // If URL has ?img=, show that image as main
    const selectedImg = params.get("img");
    if(selectedImg){
      document.getElementById("mainImage").src = decodeURIComponent(selectedImg);
    }

    document.getElementById("mainImage").onclick = () => {
      // Open full screen or product page logic
      window.location.href = "product.html?id=" + productId;
    };
  }

  function addToCart(){
    if(!currentProduct) return;
    alert(`Added "${currentProduct.name}" to cart`);
    // TODO: implement Firestore or localStorage cart logic
  }

  function buyNow(){
    if(!currentProduct) return;
    window.location.href = "checkout.html?id=" + productId;
  }

  function addWishlist(){
    const user = auth.currentUser;
    if(!user || !currentProduct){ alert("Please wait..."); return; }
    db.collection("wishlist").add({
      userId: user.uid,
      productId: productId,
      name: currentProduct.name || "",
      price: currentProduct.price || 0,
      image: currentProduct.image || (currentProduct.images ? currentProduct.images[0] : ""),
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    }).then(()=>{
      alert("Added to wishlist ❤️");
    }).catch(err=>{
      console.error(err);
      alert("Failed to add to wishlist");
    });
  }
</script>

 <!-- Your product list HTML here -->
<div class="product">
  <h3>Kid Hoodie</h3>
  <p>₦1500</p>
  <button class="buy-now-btn" 
          data-id="abc123" 
          data-name="Kid Hoodie" 
          data-price="1500" 
          data-image="https://i.imgur.com/3ZQ3Q0P.jpeg">
    Buy Now
  </button>
</div>

<!-- Firebase scripts -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
  import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

  const firebaseConfig = { /* your config */ };
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  signInAnonymously(auth);

  async function placeOrder(product) {
    if (!auth.currentUser) return alert("User not authenticated");

    try {
      await addDoc(collection(db, "orders"), {
        userId: auth.currentUser.uid,
        productId: product.id,
        productName: product.name,
        price: product.price,
        quantity: product.quantity || 1,
        image: product.image || "",
        status: "pending",
        createdAt: serverTimestamp()
      });
      alert("Order placed successfully ✅");
    } catch (err) {
      console.error(err);
      alert("Failed to place order ❌");
    }
  }

  document.querySelectorAll(".buy-now-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      const product = {
        id: btn.dataset.id,
        name: btn.dataset.name,
        price: Number(btn.dataset.price),
        image: btn.dataset.image
      };
      placeOrder(product);
    });
  });
</script>

</body>
</html>
