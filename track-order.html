<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Delivery Tracking | Blackwear</title>

<style>
body{
  margin:0;padding:20px;
  background:#0f0f0f;
  color:#fff;
  font-family:system-ui
}
h1{color:#ff7f00}
.card{
  background:#141414;
  border-radius:14px;
  padding:16px;
  margin-bottom:14px;
  cursor:pointer;
  border:1px solid #1f1f1f
}
.badge{
  padding:6px 12px;
  border-radius:999px;
  font-size:12px;
  background:#333;
  float:right
}
.details{
  display:none;
  margin-top:14px;
  background:#000;
  padding:12px;
  border-radius:12px
}
.item{
  display:flex;
  gap:10px;
  margin-bottom:10px
}
.item img{
  width:60px;height:60px;
  border-radius:8px;
  object-fit:cover
}
.progress{
  height:6px;
  background:#333;
  border-radius:6px;
  overflow:hidden;
  margin-top:8px
}
.progress span{
  display:block;
  height:100%;
  background:#ff7f00
}
.small{color:#aaa;font-size:13px}
</style>
</head>

<body>

<h1>Delivery Tracking</h1>
<div id="orders"></div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyBy0bIMp1ORV0UfLgKlxyr2V-I9mJjFb6o",
  authDomain:"blackwear-14a31.firebaseapp.com",
  projectId:"blackwear-14a31"
});

const auth = firebase.auth();
const db = firebase.firestore();
const container = document.getElementById("orders");

/* ---------- AUTH ---------- */
auth.onAuthStateChanged(async user=>{
  if(!user) await auth.signInAnonymously();
  loadOrders();
});

/* ---------- LOAD ORDERS ---------- */
async function loadOrders(){
  const snap = await db.collection("orders")
    .where("userId","==",auth.currentUser.uid)
    .orderBy("createdAt","desc")
    .get();

  if(snap.empty){
    container.innerHTML = "<p>No orders found.</p>";
    return;
  }

  container.innerHTML = "";

  snap.forEach(doc=>{
    const o = doc.data();
    const progress = o.deliveryProgress ?? 0;
    const est = o.estimatedDelivery ?? "—";

    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <strong>Order #${o.orderId || doc.id}</strong>
      <span class="badge">${o.deliveryStatus || "pending"}</span>

      <div class="small">
        Ordered: ${o.createdAt?.toDate().toLocaleDateString()}
      </div>

      <div class="progress">
        <span style="width:${progress}%"></span>
      </div>
      <div class="small">Delivery progress: ${progress}%</div>

      <div class="details"></div>
    `;

    const details = card.querySelector(".details");

    o.items.forEach(it=>{
      details.innerHTML += `
        <div class="item">
          <img src="${it.image || ''}">
          <div>
            <div>${it.productName || it.name}</div>
            <div class="small">
              ₦${Number(it.price).toLocaleString()} × ${it.quantity || 1}
            </div>
          </div>
        </div>
      `;
    });

    details.innerHTML += `
      <div class="small">Payment: ${o.payment?.status || "pending"}</div>
      <div class="small">Estimated Delivery: ${est}</div>
    `;

    card.onclick = ()=>{
      details.style.display =
        details.style.display === "block" ? "none" : "block";
    };

    container.appendChild(card);
  });
}
</script>

</body>
</html>
