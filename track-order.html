<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Delivery Tracking | Blackwear</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  background:#0f0f0f;
  color:#fff;
  font-family:system-ui;
  margin:0;
  padding:15px;
}
.order-card{
  background:#141414;
  border-radius:14px;
  padding:14px;
  margin-bottom:15px;
}
.order-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:pointer;
}
.status{
  background:#333;
  padding:6px 12px;
  border-radius:20px;
  font-size:12px;
}
.products{
  display:none;
  margin-top:12px;
}
.product{
  display:flex;
  gap:12px;
  border-bottom:1px solid #333;
  padding:10px 0;
}
.product img{
  width:60px;
  height:60px;
  object-fit:cover;
  border-radius:8px;
}
.price{
  color:#ff7f00;
  font-weight:bold;
}
.meta{
  font-size:13px;
  color:#aaa;
}
</style>
</head>

<body>

<h2>Delivery Tracking</h2>
<div id="orders"></div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyBy0bIMp1ORV0UfLgKlxyr2V-I9mJjFb6o",
  authDomain: "blackwear-14a31.firebaseapp.com",
  projectId: "blackwear-14a31"
});

const auth = firebase.auth();
const db = firebase.firestore();
const ordersDiv = document.getElementById("orders");

auth.onAuthStateChanged(user => {
  if(!user){
    ordersDiv.innerHTML = "<p>Please login to view your orders.</p>";
    return;
  }

  db.collection("orders")
    .where("userId", "==", user.uid)
    .orderBy("createdAt", "desc")
    .get()
    .then(snapshot => {

      if(snapshot.empty){
        ordersDiv.innerHTML = "<p>No orders found.</p>";
        return;
      }

      snapshot.forEach(doc => {
        const order = doc.data();

        const card = document.createElement("div");
        card.className = "order-card";

        const header = document.createElement("div");
        header.className = "order-header";
        header.innerHTML = `
          <div>
            <strong>Order #${order.orderId}</strong><br>
            <span class="meta">
              Ordered: ${order.createdAt.toDate().toDateString()}<br>
              Est. Delivery: ${order.estimatedDelivery || "Not set"}
            </span>
          </div>
          <div class="status">${order.orderStatus || "pending"}</div>
        `;

        const products = document.createElement("div");
        products.className = "products";

        order.items.forEach(item => {
          products.innerHTML += `
            <div class="product">
              <img src="${item.image}">
              <div>
                <div>${item.productName}</div>
                <div class="price">â‚¦${Number(item.price).toLocaleString()}</div>
                <div class="meta">Qty: ${item.quantity}</div>
              </div>
            </div>
          `;
        });

        header.onclick = () => {
          products.style.display =
            products.style.display === "none" ? "block" : "none";
        };

        card.appendChild(header);
        card.appendChild(products);
        ordersDiv.appendChild(card);
      });
    })
    .catch(err => {
      console.error(err);
      ordersDiv.innerHTML = "<p>Error loading orders.</p>";
    });
});
</script>

</body>
</html>
