<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Track Order | Blackwear</title>

<style>
body{margin:0;padding:20px;background:#0f0f0f;color:#fff;font-family:system-ui}
.container{max-width:900px;margin:auto;background:#141414;padding:20px;border-radius:14px}
h1,h2{color:#ff7f00}
input{width:100%;padding:12px;margin-top:8px;border-radius:10px;border:none;background:#000;color:#fff}
button{margin-top:12px;padding:14px;border:none;border-radius:14px;background:#ff7f00;color:#000;font-weight:bold;width:100%;cursor:pointer}
.error{background:#330000;color:#ffb3b3;padding:10px;border-radius:8px;margin-top:10px}
.section{margin-top:20px}
.item{display:flex;gap:12px;align-items:center;border-bottom:1px solid #333;padding:10px 0}
.item img{width:60px;height:60px;border-radius:8px;object-fit:cover}
.total{font-size:18px;font-weight:bold;color:#ff7f00;margin-top:10px}
.progress-bar{background:#000;border-radius:10px;overflow:hidden;margin-top:8px}
.progress{height:12px;background:#ff7f00;width:0%}
.status{margin-top:6px;font-weight:bold}
</style>
</head>

<body>

<div class="container">
  <h1>Track Your Order</h1>

  <input id="orderIdInput" placeholder="Enter Order ID">
  <button onclick="track()">Track Order</button>

  <div id="error" class="error" style="display:none"></div>

  <div id="details" style="display:none">

    <div class="section">
      <h2>Customer</h2>
      <p id="custName"></p>
      <p id="custPhone"></p>
      <p id="custAddress"></p>
    </div>

    <div class="section">
      <h2>Items</h2>
      <div id="items"></div>
      <div class="total" id="total"></div>
    </div>

    <div class="section">
      <h2>Payment</h2>
      <p id="payMethod"></p>
      <p id="payRef"></p>
      <p id="payStatus"></p>
    </div>

    <div class="section">
      <h2>Delivery</h2>
      <div class="progress-bar">
        <div class="progress" id="progress"></div>
      </div>
      <div class="status" id="deliveryStatus"></div>
      <p id="estimated"></p>
    </div>

  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyBy0bIMp1ORV0UfLgKlxyr2V-I9mJjFb6o",
  authDomain: "blackwear-14a31.firebaseapp.com",
  projectId: "blackwear-14a31"
});

const db = firebase.firestore();
const el = id => document.getElementById(id);

function deliveryPercent(status){
  if(status === "pending") return 10;
  if(status === "processing") return 35;
  if(status === "shipped") return 70;
  if(status === "delivered") return 100;
  return 0;
}

async function loadOrder(id){
  el("error").style.display = "none";
  el("details").style.display = "none";

  try{
    const doc = await db.collection("orders").doc(id).get();
    if(!doc.exists){
      el("error").textContent = "Order not found";
      el("error").style.display = "block";
      return;
    }

    const d = doc.data();

    // Customer
    el("custName").textContent = "Name: " + d.customer.name;
    el("custPhone").textContent = "Phone: " + d.customer.phone;
    el("custAddress").textContent = "Address: " + d.customer.address;

    // Items
    el("items").innerHTML = "";
    d.items.forEach(i=>{
      const div = document.createElement("div");
      div.className = "item";
      div.innerHTML = `
        <img src="${i.image || ''}">
        <div>
          <div>${i.productName}</div>
          <div>₦${Number(i.price).toLocaleString()} × ${i.quantity || 1}</div>
        </div>
      `;
      el("items").appendChild(div);
    });

    el("total").textContent = "Total: ₦" + Number(d.total).toLocaleString();

    // Payment
    el("payMethod").textContent = "Method: " + d.payment.method;
    el("payRef").textContent = "Reference: " + d.payment.reference;
    el("payStatus").textContent = "Status: " + d.payment.status;

    // Delivery
    const status = d.deliveryStatus || "pending";
    const percent = deliveryPercent(status);
    el("progress").style.width = percent + "%";
    el("deliveryStatus").textContent = "Status: " + status.toUpperCase();
    el("estimated").textContent = "Estimated delivery: " + (d.estimatedDelivery || "Not set");

    el("details").style.display = "block";

  }catch(err){
    console.error(err);
    el("error").textContent = "Error loading order";
    el("error").style.display = "block";
  }
}

function track(){
  const id = el("orderIdInput").value.trim();
  if(!id){
    el("error").textContent = "Enter Order ID";
    el("error").style.display = "block";
    return;
  }
  loadOrder(id);
}

// Auto load from URL
const params = new URLSearchParams(location.search);
if(params.get("id")){
  el("orderIdInput").value = params.get("id");
  loadOrder(params.get("id"));
}
</script>

</body>
</html>
