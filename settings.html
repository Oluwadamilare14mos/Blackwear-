<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Settings | Blackwear</title>
<style>
body{
  margin:0;
  padding:20px;
  background:#0f0f0f;
  color:#fff;
  font-family:system-ui;
}
.container{
  max-width:700px;
  margin:auto;
  background:#141414;
  padding:20px;
  border-radius:14px;
}
h1{
  color:#ff7f00;
  margin-bottom:20px;
}
.section{
  margin-bottom:25px;
}
label{
  display:block;
  margin-bottom:6px;
  font-weight:600;
}
input, select{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:none;
  background:#000;
  color:#fff;
}
.save-btn{
  width:100%;
  padding:14px;
  border:none;
  border-radius:14px;
  background:#ff7f00;
  color:#000;
  font-weight:bold;
  font-size:16px;
  cursor:pointer;
}
.success{
  display:none;
  background:#003300;
  color:#00ff88;
  padding:12px;
  border-radius:10px;
  margin-top:15px;
}
</style>
</head>
<body>
<div class="container">
  <h1>Account Settings</h1>

  <!-- Profile -->
  <div class="section">
    <h3>Profile Information</h3>
    <label>Full Name</label>
    <input id="name" placeholder="Your name">

    <label>Phone Number</label>
    <input id="phone" placeholder="Your phone">

    <label>Delivery Address</label>
    <input id="address" placeholder="Delivery address">
  </div>

  <!-- Preferences -->
  <div class="section">
    <h3>Preferences</h3>

    <label>Delivery Notification</label>
    <select id="notify">
      <option value="whatsapp">WhatsApp</option>
      <option value="sms">SMS</option>
      <option value="email">Email</option>
    </select>

    <label>Preferred Delivery Time</label>
    <select id="deliveryTime">
      <option value="morning">Morning</option>
      <option value="afternoon">Afternoon</option>
      <option value="evening">Evening</option>
    </select>
  </div>

  <button class="save-btn" id="saveBtn">Save Settings</button>
  <div class="success" id="success">Settings updated successfully</div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyBy0bIMp1ORV0UfLgKlxyr2V-I9mJjFb6o",
  authDomain: "blackwear-14a31.firebaseapp.com",
  projectId: "blackwear-14a31"
});

const auth = firebase.auth();
const db = firebase.firestore();
const el = id => document.getElementById(id);

let uid = null;

// Sign in anonymously
auth.onAuthStateChanged(async user => {
  if(!user){
    await auth.signInAnonymously();
  }
  uid = auth.currentUser.uid;
  loadSettings();
});

// Load settings from Firestore
async function loadSettings(){
  if(!uid) return;

  const doc = await db.collection("users").doc(uid).get();
  if(!doc.exists) return;

  const data = doc.data();
  el("name").value = data.name || "";
  el("phone").value = data.phone || "";
  el("address").value = data.address || "";
  el("notify").value = data.notify || "whatsapp";
  el("deliveryTime").value = data.deliveryTime || "morning";
}

// Save settings
el("saveBtn").onclick = async () => {
  if(!uid) return;

  try {
    await db.collection("users").doc(uid).set({
      name: el("name").value,
      phone: el("phone").value,
      address: el("address").value,
      notify: el("notify").value,
      deliveryTime: el("deliveryTime").value,
      updatedAt: firebase.firestore.FieldValue.serverTimestamp()
    }, { merge:true });

    el("success").style.display = "block";
    setTimeout(() => el("success").style.display = "none", 3000);
  } catch(err){
    console.error(err);
    alert("Failed to save settings. Check console.");
  }
};
</script>
</body>
</html>
