<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Profile — Blackwear</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { background:#0b0b0b; color:white; font-family:Poppins,sans-serif; }
  .btn { transition:.2s }
  .btn:hover { transform:scale(1.05) }
</style>
</head>

<body class="min-h-screen flex items-center justify-center px-4">

<div class="bg-[#111] w-full max-w-md p-6 rounded-xl shadow-lg relative">

  <!-- Back button -->
  <button onclick="window.location.href='index.html'"
    class="absolute left-4 top-4 text-orange-500 text-sm btn">
    ← Back
  </button>

  <h1 class="text-2xl font-bold text-orange-500 text-center mb-6">My Profile</h1>

  <!-- Profile Image -->
  <div class="flex flex-col items-center mb-4">
    <img id="profilePic"
      src="https://via.placeholder.com/120"
      class="w-28 h-28 rounded-full border-2 border-orange-500 object-cover mb-2" />

    <input id="profileImageInput" type="file" accept="image/*"
      class="text-sm text-gray-400 mb-2" />

    <button id="uploadPicBtn"
      class="bg-orange-500 text-black px-4 py-2 rounded-lg text-sm btn">
      Upload Picture
    </button>

    <p id="uploadMsg" class="text-xs mt-2"></p>
  </div>

  <!-- Form -->
  <input id="displayName" type="text"
    placeholder="Full Name"
    class="w-full p-3 mb-3 rounded-lg bg-[#222] text-white" />

  <input id="email" type="email"
    disabled
    class="w-full p-3 mb-3 rounded-lg bg-[#1a1a1a] text-gray-400 cursor-not-allowed" />

  <!-- Gender -->
  <select id="gender"
    class="w-full p-3 mb-3 rounded-lg bg-[#222] text-white">
    <option value="">Select Gender</option>
    <option>Male</option>
    <option>Female</option>
    <option>Other</option>
  </select>

  <!-- Age -->
  <input id="age" type="number" min="1"
    placeholder="Age"
    class="w-full p-3 mb-4 rounded-lg bg-[#222] text-white" />

  <button id="saveProfileBtn"
    class="w-full bg-orange-500 text-black p-3 rounded-lg font-semibold btn">
    Save Profile
  </button>

  <button id="signOutBtn"
    class="w-full mt-3 bg-[#222] text-orange-500 p-3 rounded-lg font-semibold btn">
    Sign Out
  </button>

  <p id="msg" class="text-center mt-3 text-sm"></p>

</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBy0bIMp1ORV0UfLgKlxyr2V-I9mJjFb6o",
  authDomain: "blackwear-14a31.firebaseapp.com",
  projectId: "blackwear-14a31",
  storageBucket: "blackwear-14a31.appspot.com",
  messagingSenderId: "222479690292",
  appId: "1:222479690292:web:82bd91e186da6412133861"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();

const profilePic = document.getElementById("profilePic");
const displayName = document.getElementById("displayName");
const email = document.getElementById("email");
const gender = document.getElementById("gender");
const age = document.getElementById("age");
const msg = document.getElementById("msg");
const uploadMsg = document.getElementById("uploadMsg");

auth.onAuthStateChanged(async user => {
  if (!user) return window.location.replace("login.html");

  email.value = user.email;
  displayName.value = user.displayName || "";
  if (user.photoURL) profilePic.src = user.photoURL;

  const snap = await db.collection("users").doc(user.uid).get();
  if (snap.exists) {
    const d = snap.data();
    gender.value = d.gender || "";
    age.value = d.age || "";
  }
});

// Upload profile image
document.getElementById("uploadPicBtn").onclick = async () => {
  const file = document.getElementById("profileImageInput").files[0];
  if (!file) return uploadMsg.textContent = "Select an image first";

  uploadMsg.textContent = "Uploading...";
  const ref = storage.ref(`profile_pics/${auth.currentUser.uid}`);
  await ref.put(file);
  const url = await ref.getDownloadURL();
  await auth.currentUser.updateProfile({ photoURL: url });
  profilePic.src = url;
  uploadMsg.textContent = "Profile picture updated";
};

// Save profile
document.getElementById("saveProfileBtn").onclick = async () => {
  const user = auth.currentUser;
  msg.textContent = "Saving...";
  try {
    await user.updateProfile({ displayName: displayName.value });
    await db.collection("users").doc(user.uid).set({
      name: displayName.value,
      email: user.email,
      gender: gender.value,
      age: age.value,
      updatedAt: firebase.firestore.FieldValue.serverTimestamp()
    }, { merge: true });

    msg.textContent = "Profile updated successfully";
    msg.style.color = "lightgreen";
  } catch (e) {
    msg.textContent = "Failed to update profile";
    msg.style.color = "red";
  }
};

document.getElementById("signOutBtn").onclick = () =>
  auth.signOut().then(() => window.location.replace("login.html"));
</script>

</body>
</html>
