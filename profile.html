<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Profile — Blackwear</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { background: #0b0b0b; font-family: Poppins, sans-serif; color: white; }
  .profile-card { background: #111; border-radius: 1rem; padding: 2rem; width: 100%; max-width: 450px; box-shadow: 0 10px 25px rgba(0,0,0,0.6); }
  .profile-pic { width: 140px; height: 140px; border-radius: 9999px; border: 3px solid #ff7f00; object-fit: cover; transition: transform 0.2s; }
  .profile-pic:hover { transform: scale(1.05); }
  input, select { background: #1a1a1a; border: 1px solid #333; border-radius: 0.5rem; padding: 1rem; width: 100%; font-size: 1rem; color: white; outline: none; }
  input:focus, select:focus { border-color: #ff7f00; }
  .btn-orange { background: #ff7f00; color: black; transition: 0.2s; }
  .btn-orange:hover { background: #ff6a00; }
</style>
</head>
<body class="flex flex-col items-center min-h-screen p-5">

<!-- Header -->
<header class="w-full flex justify-between items-center mb-6">
  <a href="index.html" class="border border-white px-4 py-2 rounded-lg hover:bg-white hover:text-black transition">Back to Shop</a>
  <h1 class="text-2xl font-bold text-brand">Profile</h1>
</header>

<main class="flex flex-col items-center w-full space-y-6">

  <!-- Profile Picture -->
  <div class="flex flex-col items-center space-y-3">
    <img id="profilePic" src="https://via.placeholder.com/140" alt="Profile Picture" class="profile-pic">
    <label class="btn-orange px-6 py-2 rounded-lg font-semibold cursor-pointer">
      Upload Photo
      <input id="picInput" type="file" accept="image/*" class="hidden">
    </label>
  </div>

  <!-- Profile Details Card -->
  <div class="profile-card space-y-4">
    <form id="profileForm" class="space-y-4">
      <div>
        <label class="text-gray-400 text-sm mb-1 block">First Name</label>
        <input type="text" id="firstName" placeholder="First Name">
      </div>
      <div>
        <label class="text-gray-400 text-sm mb-1 block">Last Name</label>
        <input type="text" id="lastName" placeholder="Last Name">
      </div>
      <div>
        <label class="text-gray-400 text-sm mb-1 block">Age</label>
        <input type="number" id="age" placeholder="Age">
      </div>
      <div>
        <label class="text-gray-400 text-sm mb-1 block">Gender</label>
        <select id="gender">
          <option value="">Select Gender</option>
          <option value="Male">Male</option>
          <option value="Female">Female</option>
          <option value="Other">Other</option>
        </select>
      </div>
      <div>
        <label class="text-gray-400 text-sm mb-1 block">Email</label>
        <input type="email" id="email" placeholder="Email" disabled>
      </div>
      <div>
        <label class="text-gray-400 text-sm mb-1 block">Phone</label>
        <input type="tel" id="phone" placeholder="Phone">
      </div>
      <button type="submit" class="btn-orange w-full py-3 rounded-lg font-semibold mt-2">Save Changes</button>
    </form>
  </div>

  <!-- Sign Out Button at Bottom -->
  <button id="signOutBtn" class="btn-orange px-6 py-3 rounded-lg font-semibold mt-6">Sign Out</button>

</main>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBy0bIMp1ORV0UfLgKlxyr2V-I9mJjFb6o",
  authDomain: "blackwear-14a31.firebaseapp.com",
  projectId: "blackwear-14a31",
  storageBucket: "blackwear-14a31.appspot.com"
};
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();

const profilePic = document.getElementById("profilePic");
const picInput = document.getElementById("picInput");
const firstName = document.getElementById("firstName");
const lastName = document.getElementById("lastName");
const age = document.getElementById("age");
const gender = document.getElementById("gender");
const email = document.getElementById("email");
const phone = document.getElementById("phone");
const signOutBtn = document.getElementById("signOutBtn");
const profileForm = document.getElementById("profileForm");

auth.onAuthStateChanged(async (user) => {
  if (!user) { window.location.href = "login.html"; return; }

  // Load profile
  const userDoc = await db.collection("users").doc(user.uid).get();
  if (userDoc.exists) {
    const data = userDoc.data();
    firstName.value = data.firstName || '';
    lastName.value = data.lastName || '';
    age.value = data.age || '';
    gender.value = data.gender || '';
    email.value = data.email || '';
    phone.value = data.phone || '';
    if (data.photoURL) profilePic.src = data.photoURL;
  }
});

// Upload profile picture
picInput.addEventListener("change", async (e) => {
  const file = e.target.files[0];
  if (!file) return;
  const user = auth.currentUser;
  const storageRef = storage.ref().child(`profilePictures/${user.uid}`);
  const uploadTask = storageRef.put(file);

  uploadTask.on('state_changed', null, 
    (error) => console.error("Upload error:", error),
    async () => {
      const downloadURL = await uploadTask.snapshot.ref.getDownloadURL();
      profilePic.src = downloadURL;
      await db.collection("users").doc(auth.currentUser.uid).update({ photoURL: downloadURL });
    }
  );
});

// Save changes
profileForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  const user = auth.currentUser;
  await db.collection("users").doc(user.uid).set({
    firstName: firstName.value,
    lastName: lastName.value,
    age: age.value,
    gender: gender.value,
    phone: phone.value
  }, { merge: true });
  alert("Profile updated ✅");
});

// Sign out
signOutBtn.addEventListener("click", () => {
  auth.signOut().then(() => window.location.href = "login.html");
});
</script>
</body>
</html>
