<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Track Order — Blackwear</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { background:#0b0b0b; font-family:Poppins,sans-serif; color:#fff; min-height:100vh; margin:0; padding:20px; }
  .card { max-width:700px; margin:auto; background:#141414; border-radius:16px; padding:20px; }
  h1,h2,h3 { margin:0 0 10px; color:#ff7f00; }
  .section { margin-bottom:20px; }
  .item { display:flex; justify-content:space-between; margin-top:6px; }
  .status { font-weight:bold; padding:4px 8px; border-radius:6px; }
  .status.pending { background:#fbbf24; color:#000; }
  .status.shipped { background:#3b82f6; color:#fff; }
  .status.delivered { background:#16a34a; color:#fff; }
</style>
</head>
<body>

<div class="card">
  <h1>Track Your Order</h1>

  <div id="loading" class="section text-gray-400">Loading order...</div>
  <div id="error" class="section text-red-500 hidden">Order not found or cannot be accessed.</div>

  <div id="orderDetails" class="hidden">
    <div class="section">
      <h2>Order Info</h2>
      <p><strong>Order ID:</strong> <span id="orderId"></span></p>
      <p><strong>Status:</strong> <span id="orderStatus" class="status"></span></p>
      <p><strong>Placed:</strong> <span id="orderDate"></span></p>
    </div>

    <div class="section">
      <h2>Customer Details</h2>
      <p><strong>Name:</strong> <span id="customerName"></span></p>
      <p><strong>Phone:</strong> <span id="customerPhone"></span></p>
      <p><strong>Address:</strong> <span id="customerAddress"></span></p>
    </div>

    <div class="section">
      <h2>Items</h2>
      <div id="itemsList"></div>
      <p class="mt-2 font-bold">Total: ₦<span id="totalAmount"></span></p>
    </div>
  </div>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBy0bIMp1ORV0UfLgKlxyr2V-I9mJjFb6o",
  authDomain: "blackwear-14a31.firebaseapp.com",
  projectId: "blackwear-14a31"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const params = new URLSearchParams(window.location.search);
const orderId = params.get("id");

const loadingEl = document.getElementById("loading");
const errorEl = document.getElementById("error");
const orderDetailsEl = document.getElementById("orderDetails");

if (!orderId) {
  loadingEl.style.display = "none";
  errorEl.textContent = "No order ID provided in URL.";
  errorEl.classList.remove("hidden");
} else {
  async function loadOrder() {
    try {
      const orderRef = doc(db, "orders", orderId);
      const orderSnap = await getDoc(orderRef);

      if (!orderSnap.exists()) {
        throw new Error("Order not found");
      }

      const order = orderSnap.data();

      // Display order info
      document.getElementById("orderId").textContent = orderId;
      const statusEl = document.getElementById("orderStatus");
      const status = order.orderStatus || "pending";
      statusEl.textContent = status.replace(/_/g, " ");
      statusEl.className = "status " + status;

      const createdAt = order.createdAt?.toDate?.() || new Date();
      document.getElementById("orderDate").textContent = createdAt.toLocaleString();

      // Customer info
      const c = order.customer || {};
      document.getElementById("customerName").textContent = c.name || "-";
      document.getElementById("customerPhone").textContent = c.phone || "-";
      document.getElementById("customerAddress").textContent = c.address || "-";

      // Items
      const itemsList = document.getElementById("itemsList");
      itemsList.innerHTML = "";
      let total = 0;
      (order.items || []).forEach(item => {
        const qty = item.qty || item.quantity || 1;
        const price = Number(item.price || 0);
        total += price * qty;
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `<span>${item.productName || item.name} × ${qty}</span><span>₦${price.toLocaleString()}</span>`;
        itemsList.appendChild(div);
      });
      document.getElementById("totalAmount").textContent = total.toLocaleString();

      // Show order details
      loadingEl.style.display = "none";
      orderDetailsEl.classList.remove("hidden");
    } catch (err) {
      console.error("Error loading order:", err);
      loadingEl.style.display = "none";
      errorEl.classList.remove("hidden");
    }
  }

  loadOrder();
}
</script>

</body>
</html>
