<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Track Order | Blackwear</title>
<style>
body {margin:0;padding:20px;background:#0f0f0f;color:#fff;font-family:system-ui;}
.card {max-width:900px;margin:auto;background:#141414;border-radius:16px;padding:20px;}
h1,h2 {margin:0 0 12px;color:#ff7f00;}
.order-item {display:flex;justify-content:space-between;font-size:14px;margin-top:6px;}
.total {font-size:18px;font-weight:bold;margin-top:10px;}
.payment, .status, .customer {background:#000;padding:12px;border-radius:10px;margin-top:10px;}
</style>
</head>
<body>

<div class="card">
  <h1>Order Details</h1>
  <div id="loading">Loading order…</div>

  <div id="orderDetails" class="hidden">
    <h2>Customer Details</h2>
    <div class="customer" id="customer"></div>

    <h2>Items</h2>
    <div id="items"></div>
    <div class="total" id="total"></div>

    <h2>Payment</h2>
    <div class="payment" id="payment"></div>

    <h2>Status</h2>
    <div class="status" id="status"></div>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyBy0bIMp1ORV0UfLgKlxyr2V-I9mJjFb6o",
  authDomain: "blackwear-14a31.firebaseapp.com",
  projectId: "blackwear-14a31"
});

const db = firebase.firestore();
const el = id => document.getElementById(id);

// Get order ID from URL
const params = new URLSearchParams(window.location.search);
const orderId = params.get("id");

if (!orderId) {
  el("loading").innerText = "No order ID provided.";
} else {
  db.collection("orders").doc(orderId).get()
    .then(doc => {
      if (!doc.exists) {
        el("loading").innerText = "Order not found.";
        return;
      }

      const o = doc.data();
      el("loading").style.display = "none";
      const details = el("orderDetails");
      details.classList.remove("hidden");

      // Customer
      const c = o.customer || {};
      el("customer").innerHTML = `
        Name: ${c.name || ""}<br>
        Phone: ${c.phone || ""}<br>
        Address: ${c.address || ""}
      `;

      // Items
      const itemsEl = el("items");
      itemsEl.innerHTML = "";
      (o.items || []).forEach(item => {
        itemsEl.innerHTML += `
          <div class="order-item">
            <span>${item.productName || item.name} × ${item.qty || item.quantity || 1}</span>
            <span>₦${Number(item.price).toLocaleString()}</span>
          </div>
        `;
      });
      el("total").innerText = "Total: ₦" + (o.total || 0).toLocaleString();

      // Payment
      const p = o.payment || {};
      el("payment").innerHTML = `
        Method: ${p.method || "-"}<br>
        Reference: ${p.reference || "-"}<br>
        Status: ${p.status || "-"}
      `;

      // Status
      el("status").innerHTML = `
        Order Status: ${o.orderStatus || "-"}<br>
        Delivery Status: ${o.deliveryStatus || "-"}<br>
        Created At: ${o.createdAt?.toDate().toLocaleString() || "-"}
      `;
    })
    .catch(err => {
      console.error("Tracking error:", err);
      el("loading").innerText = "Error loading order. Try again later.";
    });
}
</script>

</body>
</html>
