<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Track Order | Blackwear</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com"></script>
<script>
  tailwind.config = {
    theme: {
      extend: {
        colors: { brand: "#ff7f00", dark: "#0b0b0b" },
        fontFamily: { poppins: ["Poppins", "sans-serif"] },
      },
    },
  };
</script>
<style>
body { background: #0b0b0b; font-family: Poppins, sans-serif; color: white; }
</style>
</head>
<body class="min-h-screen">

<header class="p-5 bg-dark flex justify-between items-center shadow-lg">
  <h1 class="text-2xl font-bold text-brand">Track Order</h1>
  <a href="index.html" class="bg-brand text-black px-4 py-2 rounded-lg font-semibold">Back</a>
</header>

<main class="p-5 max-w-4xl mx-auto space-y-6">
  <div id="loading" class="text-center text-gray-400">Loading order...</div>
  <div id="orderContainer" class="space-y-5 hidden"></div>
  <div id="error" class="hidden text-center text-red-500">Order not found or invalid ID.</div>
</main>

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyBy0bIMp1ORV0UfLgKlxyr2V-I9mJjFb6o",
  authDomain: "blackwear-14a31.firebaseapp.com",
  projectId: "blackwear-14a31"
});

const db = firebase.firestore();
const queryParams = new URLSearchParams(window.location.search);
const orderId = queryParams.get("id");

const loading = document.getElementById("loading");
const orderContainer = document.getElementById("orderContainer");
const errorEl = document.getElementById("error");

if (!orderId) {
  loading.classList.add("hidden");
  errorEl.classList.remove("hidden");
} else {
  db.collection("orders").doc(orderId).get().then(docSnap => {
    loading.classList.add("hidden");

    if (!docSnap.exists) {
      errorEl.classList.remove("hidden");
      return;
    }

    const order = docSnap.data();
    orderContainer.classList.remove("hidden");

    let itemsHTML = "";
    if (Array.isArray(order.items) && order.items.length) {
      order.items.forEach(item => {
        itemsHTML += `
          <div class="flex justify-between border-b border-gray-700 py-2">
            <span>${item.productName || item.name} × ${item.qty || 1}</span>
            <span>₦${Number(item.price).toLocaleString()}</span>
          </div>`;
      });
    }

    orderContainer.innerHTML = `
      <div class="bg-[#111] p-5 rounded-xl border border-gray-700 shadow-lg">
        <h2 class="font-semibold text-brand mb-3">Order #${orderId.slice(0,8).toUpperCase()}</h2>
        <div class="mb-3">
          <p><strong>Name:</strong> ${order.customer?.name || "-"}</p>
          <p><strong>Phone:</strong> ${order.customer?.phone || "-"}</p>
          <p><strong>Address:</strong> ${order.customer?.address || "-"}</p>
        </div>
        <div class="mb-3">
          <h3 class="font-semibold mb-2">Items</h3>
          <div>${itemsHTML}</div>
        </div>
        <p class="font-semibold text-lg mt-3">Total: ₦${Number(order.total||0).toLocaleString()}</p>
      </div>
    `;
  }).catch(err => {
    console.error("Error loading order:", err);
    loading.classList.add("hidden");
    errorEl.classList.remove("hidden");
  });
}
</script>

</body>
</html>
