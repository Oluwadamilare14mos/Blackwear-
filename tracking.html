<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Track Order | Blackwear</title>

<style>
body{margin:0;padding:20px;background:#0f0f0f;color:#fff;font-family:system-ui}
.card{max-width:900px;margin:auto;background:#141414;border-radius:16px;padding:20px}
h1,h2{margin:0 0 12px;color:#ff7f00}
.box{background:#000;padding:12px;border-radius:10px;margin-top:10px}
.order-item{display:flex;justify-content:space-between;font-size:14px;margin-top:6px}
.total{font-size:18px;font-weight:bold;margin-top:10px}
.muted{color:#aaa;font-size:13px}
.badge{
  display:inline-block;
  padding:4px 10px;
  border-radius:999px;
  font-size:12px;
  margin-top:6px
}
.pending{background:#333;color:#ffb347}
.success{background:#0a3;color:#000}
.info{background:#025;color:#7cf}
</style>
</head>

<body>

<div class="card">
  <h1>Order Tracking</h1>
  <div id="loading">Loading order…</div>

  <div id="content" style="display:none">

    <h2>Customer</h2>
    <div class="box" id="customer"></div>

    <h2>Items</h2>
    <div class="box" id="items"></div>
    <div class="total" id="total"></div>

    <h2>Payment</h2>
    <div class="box" id="payment"></div>

    <h2>Status</h2>
    <div class="box" id="status"></div>

  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyBy0bIMp1ORV0UfLgKlxyr2V-I9mJjFb6o",
  authDomain: "blackwear-14a31.firebaseapp.com",
  projectId: "blackwear-14a31"
});

const db = firebase.firestore();
const $ = id => document.getElementById(id);

// GET ORDER ID
const params = new URLSearchParams(location.search);
const orderId = params.get("id");

if (!orderId) {
  $("loading").innerText = "No order ID provided.";
} else {
  db.collection("orders").doc(orderId).get()
    .then(doc => {
      if (!doc.exists) {
        $("loading").innerText = "Order not found.";
        return;
      }

      const o = doc.data();

      $("loading").style.display = "none";
      $("content").style.display = "block";

      /* CUSTOMER */
      const c = o.customer || {};
      $("customer").innerHTML = `
        <b>Name:</b> ${c.name || "-"}<br>
        <b>Phone:</b> ${c.phone || "-"}<br>
        <b>Address:</b> ${c.address || "-"}
      `;

      /* ITEMS */
      let itemsHTML = "";
      (o.items || []).forEach(i => {
        const qty = i.qty || i.quantity || 1;
        itemsHTML += `
          <div class="order-item">
            <span>${i.productName || "Item"} × ${qty}</span>
            <span>₦${Number(i.price).toLocaleString()}</span>
          </div>
        `;
      });
      $("items").innerHTML = itemsHTML || "No items";
      $("total").innerText = "Total: ₦" + (o.total || 0).toLocaleString();

      /* PAYMENT */
      const p = o.payment || {};
      $("payment").innerHTML = `
        <b>Method:</b> ${p.method || "-"}<br>
        <b>Reference:</b> ${p.reference || "-"}<br>
        <b>Status:</b>
        <span class="badge ${p.status === 'confirmed' ? 'success' : 'pending'}">
          ${p.status || "pending"}
        </span>
      `;

      /* STATUS */
      $("status").innerHTML = `
        <b>Order Status:</b>
        <span class="badge info">${o.orderStatus || "-"}</span><br><br>

        <b>Delivery Status:</b>
        <span class="badge info">${o.deliveryStatus || "-"}</span><br><br>

        <b>Estimated Delivery:</b><br>
        <span class="muted">${o.estimatedDelivery || "-"}</span><br><br>

        <b>Created At:</b><br>
        <span class="muted">
          ${o.createdAt?.toDate().toLocaleString() || "-"}
        </span>
      `;
    })
    .catch(err => {
      console.error(err);
      $("loading").innerText = "Error loading order.";
    });
}
</script>

</body>
</html>
