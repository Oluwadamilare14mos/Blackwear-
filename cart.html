<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>My Cart | Blackwear</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:"Segoe UI",Arial}
body{background:#0f0f0f;color:#fff}

header{
background:#000;
padding:14px 16px;
display:flex;
align-items:center;
justify-content:space-between;
border-bottom:1px solid #1f1f1f
}
header h1{color:#ff7f00;font-size:20px}
header button{
background:#141414;
color:#ff7f00;
border:1px solid #2a2a2a;
padding:8px 14px;
border-radius:12px;
cursor:pointer
}

.cart-container{
padding:20px;
max-width:900px;
margin:auto
}

.cart-item{
display:flex;
gap:12px;
background:#141414;
border:1px solid #1f1f1f;
border-radius:14px;
padding:10px;
margin-bottom:12px;
align-items:center
}
.cart-item img{
width:90px;
height:90px;
border-radius:10px;
object-fit:cover
}
.cart-info{flex:1}
.cart-info h3{font-size:15px;margin-bottom:4px}
.cart-info p{color:#ff7f00;font-weight:bold}
.qty-controls{
margin-top:6px;
display:flex;
align-items:center;
gap:8px;
}
.qty-controls button{
background:#000;
color:#ff7f00;
border:1px solid #ff7f00;
padding:4px 10px;
border-radius:10px;
cursor:pointer;
font-size:12px;
}
.qty-controls span{
min-width:20px;
text-align:center;
display:inline-block;
}

.cart-actions button{
background:#000;
color:#ff7f00;
border:1px solid #ff7f00;
padding:6px 12px;
border-radius:10px;
cursor:pointer;
font-size:12px
}

.cart-summary{
margin-top:20px;
background:#141414;
border:1px solid #1f1f1f;
border-radius:16px;
padding:16px
}
.cart-summary h2{font-size:18px;margin-bottom:10px}
.total{
font-size:20px;
font-weight:bold;
color:#ff7f00
}
.checkout-btn{
margin-top:14px;
width:100%;
padding:12px;
border:none;
border-radius:14px;
background:#ff7f00;
color:#000;
font-weight:bold;
font-size:15px;
cursor:pointer
}

.empty{
text-align:center;
padding:40px;
color:#aaa
}
</style>
</head>

<body>

<header>
<button onclick="goBack()">‚Üê Back</button>
<h1>My Cart</h1>
</header>

<div class="cart-container">
<div id="cartItems"></div>

<div id="summary" class="cart-summary" style="display:none">
<h2>Order Summary</h2>
<p>Total: <span class="total" id="totalPrice">‚Ç¶0</span></p>
<button class="checkout-btn" onclick="checkout()">Proceed to Checkout</button>
</div>

<div id="emptyCart" class="empty" style="display:none">
Your cart is empty üõí
</div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
apiKey:"AIzaSyBy0bIMp1ORV0UfLgKlxyr2V-I9mJjFb6o",
authDomain:"blackwear-14a31.firebaseapp.com",
projectId:"blackwear-14a31"
});

const auth=firebase.auth();
const db=firebase.firestore();

let total=0;

auth.onAuthStateChanged(async user=>{
  if(!user){
    await auth.signInAnonymously();
  }

  const params = new URLSearchParams(window.location.search);

  if(params.get("clearCart") === "1"){
    await clearUserCart();
    history.replaceState({}, document.title, window.location.pathname);
  }

  loadCart();
});

async function loadCart(){
const user=auth.currentUser;
const snap=await db.collection("cart")
.where("userId","==",user.uid)
.get();

const container=document.getElementById("cartItems");
container.innerHTML="";
total=0;

if(snap.empty){
document.getElementById("emptyCart").style.display="block";
document.getElementById("summary").style.display="none";
return;
}

snap.forEach(doc=>{
const item=doc.data();
const qty=item.qty||1;
total+=item.price*qty;

const div=document.createElement("div");
div.className="cart-item";
div.innerHTML=`
<img src="${item.image}">
<div class="cart-info">
<h3>${item.name}</h3>
<p>‚Ç¶${Number(item.price).toLocaleString()}</p>
<div class="qty-controls">
  <button onclick="updateQty('${doc.id}', -1)">-</button>
  <span id="qty-${doc.id}">${qty}</span>
  <button onclick="updateQty('${doc.id}', 1)">+</button>
</div>
</div>
<div class="cart-actions">
<button onclick="removeItem('${doc.id}')">Remove</button>
</div>
`;
container.appendChild(div);
});

document.getElementById("totalPrice").innerText=
"‚Ç¶"+total.toLocaleString();
document.getElementById("summary").style.display="block";
}

async function updateQty(id, change){
const docRef=db.collection("cart").doc(id);
const docSnap=await docRef.get();
if(!docSnap.exists) return;

let qty=docSnap.data().qty||1;
qty+=change;
if(qty<1) qty=1;

await docRef.update({qty});
document.getElementById("qty-"+id).innerText=qty;
loadCart();
}

async function removeItem(id){
await db.collection("cart").doc(id).delete();
loadCart();
}

function checkout(){
window.location.href="checkout.html";
}

function goBack(){
window.history.back();
}

async function clearUserCart(){
  const user = auth.currentUser;
  if(!user) return;

  const snap = await db.collection("cart")
    .where("userId","==",user.uid)
    .get();

  if(snap.empty) return;

  const batch = db.batch();
  snap.forEach(doc => {
    batch.delete(doc.ref);
  });

  await batch.commit();
}
</script>

</body>
</html>
